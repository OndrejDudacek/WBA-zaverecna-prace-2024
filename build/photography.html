<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="description"
        content="Podstránka stránky, kde se dozvíte, jak mě kontaktovat a můžete mi poslat email přes kontaktní formulář.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="icon" href="./imgs/logo.svg">

    <link rel="stylesheet" href="./styles/reset.css">
    <script type="module" src="./js/components.js"></script>
    <link rel="stylesheet" href="./styles/style.css">

    <title>Fotografie</title>
</head>

<body>
    <main>
        <header class="subpage-header">
            <header-navbar></header-navbar>
            <article>
                <section class="main-section-content">
                    <section class="main-section-header">
                        <h1>Fotografie</h1>
                        <div class="side-line-dot"></div>
                    </section>
                </section>
            </article>
        </header>

        <article>
            <section class="main-section-content">
                <section class="main-section-header">
                    <h2>Galerie</h2>
                    <div class="side-line-dot"></div>
                </section>
                <section class="text-buttons">
                    <section class="gallery-filters">
                        <button class="active-filter" data-filter="all"> <i class="fa-solid fa-check"
                                style="display: initial"></i>Vše</button>
                        <button class="" data-filter="portrait"> <i class="fa-solid fa-check"></i>Portréty</button>
                        <button class="" data-filter="film"> <i class="fa-solid fa-check"></i>Film</button>
                        <button class="" data-filter="marketing"> <i class="fa-solid fa-check"></i>Marketing</button>
                        <button class="" data-filter="street"> <i class="fa-solid fa-check"></i>Street</button>
                    </section>
                </section>
                <section class="photo-gallery">
                </section>
            </section>
        </article>

        <footer>
            <footer-nav-links></footer-nav-links>
        </footer>
    </main>
    <article id="fullsize-photo">
        <button><i class="fa-solid fa-xmark"></i></button>
        <img src="">
        <section class="image-info">
            <section id="aperture">
                <span class="material-symbols-outlined">
                    camera
                </span>
                <p></p>
            </section>
            <section id="shuter-speed">
                <i class="fa-solid fa-stopwatch"></i>
                <p></p>
            </section>
            <section id="iso">
                <i>ISO</i>
                <p></p>
            </section>
            <section id="focal-lenght">
                <i class="fa-solid fa-chevron-left"></i>
                <p></p>
            </section>
            <section id="camera">
                <i class="fa-solid fa-camera"></i>
                <p></p>
            </section>
            <section id="camera-type">
                <i class="fa-solid fa-photo-film"></i>
                <p></p>
            </section>
        </section>
    </article>
    <script>
        let imagesArray;
        const gallery = document.querySelector('.photo-gallery');
        fetch('../js/imagesArray.JSON')
            .then(res => res.json())
            .then(data => {
                imagesArray = data;
                for (const image of imagesArray) {
                    const img = document.createElement('img');
                    img.src = image.thumbnailSrc;
                    img.loading = 'lazy';
                    img.dataset.filter = image.filter;
                    img.alt = image.alt;
                    img.dataset.aperture = image.aperture;
                    img.dataset.shutterSpeed = image.shutterSpeed;
                    img.dataset.iso = image.iso;
                    img.dataset.focalLength = image.focalLength;
                    img.dataset.camera = image.camera;
                    img.dataset.cameraType = image.cameraType;
                    img.dataset.fullSizeSrc = image.src
                    gallery.appendChild(img);
                    img.addEventListener('click', () => {
                        const fullsizePhoto = document.getElementById('fullsize-photo');
                        fullsizePhoto.style.display = 'flex';
                        fullsizePhoto.querySelector('img').src = img.dataset.fullSizeSrc;
                        fullsizePhoto.querySelector('#aperture p').textContent = img.dataset.aperture;
                        fullsizePhoto.querySelector('#shuter-speed p').textContent = img.dataset.shutterSpeed;
                        fullsizePhoto.querySelector('#iso p').textContent = img.dataset.iso;
                        fullsizePhoto.querySelector('#focal-lenght p').textContent = img.dataset.focalLength;
                        fullsizePhoto.querySelector('#camera p').textContent = img.dataset.camera;
                        fullsizePhoto.querySelector('#camera-type p').textContent = img.dataset.cameraType;
                    });
                }
            })
            .then(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const filter = urlParams.get('filter');
                if (filter) {
                    imageFilter(filter);
                }
            });

        document.getElementById('fullsize-photo').querySelector('button').addEventListener('click', () => {
            document.getElementById('fullsize-photo').style.display = 'none';
        });

        // Image filter
        function imageFilter(filter) {
            const images = document.querySelectorAll(".photo-gallery img");
            for (let image of images) {
                if (filter === "all") {
                    image.style.display = "block";
                } else if (image.dataset.filter === filter) {
                    image.style.display = "block";
                } else {
                    image.style.display = "none";
                }
            }

            const previousActive = document.querySelector(
                ".gallery-filters button.active-filter"
            );
            previousActive.classList.remove("active-filter");
            previousActive.children[0].style.display = "none"; // https://www.geeksforgeeks.org/how-to-get-the-child-element-of-a-parent-using-javascript/

            const active = document.querySelector(
                `.gallery-filters button[data-filter="${filter}"]`
            );
            active.classList.add("active-filter");
            active.children[0].style.display = "initial";
        }

        // https://stackoverflow.com/questions/47917596/listener-event-for-when-url-parameters-change
        let previousUrl = "";
        const observer = new MutationObserver(function (mutations) {
            if (window.location.href !== previousUrl) {
                previousUrl = window.location.href;
                const urlParams = new URLSearchParams(window.location.search);
                const filter = urlParams.get('filter');
                if (filter) {
                    imageFilter(filter);
                }
            }
        });
        const config = { subtree: true, childList: true };

        observer.observe(document, config);

        const galleryFilters = document.querySelectorAll(".gallery-filters button");
        for (let button of galleryFilters) {
            button.addEventListener("click", () => {
                const urlParams = new URLSearchParams(window.location.search); // https://www.youtube.com/watch?v=ug41_mF2dR8
                urlParams.set("filter", button.dataset.filter);
                const newUrl = `${window.location.origin}${window.location.pathname
                    }?${urlParams.toString()}`;
                window.history.pushState({}, "", newUrl);
                imageFilter(button.dataset.filter);
            });
        }


    </script>
    <script src="./js/index.js"></script>
</body>

</html>